# JAMANGO - AWS EC2 Deployment Guide (Full Stack)

This guide covers deploying both the **Frontend (Vite/React)** and **Backend (Node/Express)** on a single **AWS EC2 Ubuntu** instance using **Nginx** as a web server and reverse proxy.

---

## üìã Prerequisites
1.  **AWS Account**: Access to launch EC2 instances.
2.  **Domain Name**: Purchased from GoDaddy, Namecheap, or Route53 (required for SSL).
3.  **GitHub Repository**: Ensure your code (`jamango-backend` and `jamango-direct`) is pushed to GitHub.

---

## üöÄ Step 1: Launch EC2 Instance
1.  **Go to AWS Console** -> **EC2** -> **Launch Instance**.
2.  **Name**: `Jamango-Server`.
3.  **OS Image**: **Ubuntu Server 24.04 LTS** (Free Tier eligible).
4.  **Instance Type**: `t2.micro` (Free Tier) or `t3.small` (Recommended for production).
5.  **Key Pair**: Create a new key pair (e.g., `jamango-key.pem`) and download it.
6.  **Network Settings**:
    *   Check **Allow SSH traffic** (Anywhere or My IP).
    *   Check **Allow HTTP traffic from the internet**.
    *   Check **Allow HTTPS traffic from the internet**.
7.  **Launch Instance**.

---

## üîó Step 2: Connect to Server
1.  Open your terminal where your `.pem` key is located.
2.  Set permissions (Mac/Linux only): `chmod 400 jamango-key.pem`.
3.  SSH into the server:
    ```bash
    ssh -i "jamango-key.pem" ubuntu@<YOUR_EC2_PUBLIC_IP>
    ```

---

## üõ†Ô∏è Step 3: Install Software
Run these commands one by one on the server:

```bash
# Update System
sudo apt update && sudo apt upgrade -y

# Install Node.js (v20)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Install Nginx (Web Server)
sudo apt install -y nginx

# Install PM2 (Process Manager for Backend)
sudo npm install -g pm2

# Verify installations
node -v
npm -v
nginx -v
```

---

## üì¶ Step 4: Setup Backend
1.  **Clone Repository**:
    ```bash
    git clone https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git
    cd YOUR_REPO_NAME/jamango-backend
    ```

2.  **Install Dependencies**:
    ```bash
    npm install
    ```

3.  **Configure Environment**:
    Create the `.env` file:
    ```bash
    nano .env
    ```
    Paste your variables (Right-click to paste):
    ```env
    NODE_ENV=production
    PORT=5000
    MONGO_URI=mongodb+srv://<YOUR_MONGO_CONNECTION_STRING>
    JWT_SECRET=<YOUR_SECRET_KEY>
    RAZORPAY_KEY_ID=<YOUR_KEY_ID>
    RAZORPAY_KEY_SECRET=<YOUR_KEY_SECRET>
    ```
    *   Press `Ctrl+X`, then `Y`, then `Enter` to save.

4.  **Start Backend with PM2**:
    ```bash
    pm2 start server.js --name jamango-backend
    pm2 save
    pm2 startup
    # (Copy user specifically command generated by startup and run it)
    ```

---

## üé® Step 5: Setup Frontend
1.  **Navigate to Frontend**:
    ```bash
    cd ../jamango-direct
    ```

2.  **Install Dependencies**:
    ```bash
    npm install
    ```

3.  **Build Configuration**:
    Create a production env file for Vite:
    ```bash
    nano .env.production
    ```
    Paste this (since we are on the same server, we use relative path):
    ```env
    VITE_API_BASE_URL=/api
    VITE_RAZORPAY_KEY_ID=<YOUR_RAZORPAY_TEST_KEY_ID>
    ```
    *   **Note**: Using `/api` ensures Nginx routes requests locally.

4.  **Build to Static Files**:
    ```bash
    npm run build
    ```
    *   This creates a `dist` folder. We will point Nginx to this folder.

---

## üåê Step 6: Configure Nginx
This is the magic step that connects everything.

1.  **Edit Default Config**:
    ```bash
    sudo nano /etc/nginx/sites-available/default
    ```

2.  **Replace content with**:
    (Delete everything and paste this)

    ```nginx
    server {
        listen 80;
        server_name YOUR_DOMAIN_OR_PUBLIC_IP; 

        # 1. Serve Frontend (React/Vite)
        location / {
            root /home/ubuntu/YOUR_REPO_NAME/jamango-direct/dist;
            index index.html index.htm;
            try_files $uri $uri/ /index.html;
        }

        # 2. Proxy API Requests to Backend (Node.js)
        location /api {
            proxy_pass http://localhost:5000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
    }
    ```
    *   Replace `YOUR_REPO_NAME` with your actual folder name.
    *   If you don't have a domain yet, use the EC2 Public IP.

3.  **Restart Nginx**:
    ```bash
    sudo nginx -t  # Check for errors
    sudo systemctl restart nginx
    ```

---

## üîí Step 7: SSL (HTTPS) - *Optional but Recommended*
*Requires a domain name pointed to your EC2 IP.*

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
```

---

## ‚úÖ Deployment Checklist
*   [ ] Backend running via PM2 (`pm2 status`).
*   [ ] Frontend built (`dist` folder exists).
*   [ ] Nginx configured to point to `dist` and proxy `/api`.
*   [ ] Security Groups (Firewall) allow port 80/443.

**Your app should now be live at your IP or Domain!**
